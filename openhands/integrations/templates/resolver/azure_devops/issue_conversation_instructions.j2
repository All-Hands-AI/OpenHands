{% if selected_branch %}
You are working on work item #{{ issue_number }}: "{{ issue_title }}" in an Azure DevOps repository.
This work item has a linked development branch: {{ selected_branch }}.
A comment on the work item has been addressed to you.
{% elif issue_number %}
You are requested to fix work item #{{ issue_number }}: "{{ issue_title }}" in an Azure DevOps repository.
A comment on the work item has been addressed to you.
{% else %}
Your task is to fix the work item: "{{ issue_title }}".
{% endif %}

# Work Item Description
{{ issue_body }}

{% if previous_comments %}
# Previous Comments
For reference, here are the previous comments on the work item:

{% for comment in previous_comments %}
- @{{ comment.author }} said:
{{ comment.body }}
{% if not loop.last %}\n\n{% endif %}
{% endfor %}
{% endif %}

# Guidelines

1. Review the task carefully.
2. For all changes to actual application code (e.g. in Python or Javascript), add an appropriate test to the testing directory to make sure that the work item has been fixed
3. Run the tests, and if they pass you are done!
4. You do NOT need to write new tests if there are only changes to documentation or configuration files.

# Final Checklist
Re-read the work item title, description, and comments and make sure that you have successfully implemented all requirements.

{% if selected_branch %}
Use the Azure DevOps token and Azure DevOps REST APIs to:

1. Check out the branch {{ selected_branch }} (already exists for this work item)
2. Make your changes to the code
3. Commit your changes with a clear commit message
4. Push the changes to Azure DevOps to update the existing PR
5. DO NOT create a new PR - the branch already has an associated PR
{% else %}
{% if not repository_linked %}
This work item does not have a linked repository. First, you need to identify which repository to work in:

1. Use the Azure DevOps REST API to list all repositories in this project
2. Analyze the work item description and title to determine which repository is most appropriate
3. If there's only one repository in the project, use that one
4. Once you've identified the target repository, proceed with the steps below

{% endif %}
Use the Azure DevOps token and Azure DevOps REST APIs to:

1. Create a new branch using `users/openhands/` as a prefix (e.g `users/openhands/{{ issue_number }}`)
2. Commit your changes with a clear commit message
3. Push the branch to Azure DevOps
4. Use the `create_pr` tool to open a new pull request
5. The PR description should:
   - Mention that it "fixes" or "closes" the work item number
   - Include a clear summary of the changes
   - Reference any related work items
{% endif %}
