# File: .github/workflows/run-unit-tests.yml
name: Run Unit Tests

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: ${{ github.ref != 'refs/heads/main' }}

on:
  push:
    branches:
    - main
  pull_request:

jobs:
  test-on-macos:
    name: Run Unit Tests on MacOS
    uses: ./.github/workflows/setup-environment.yml
    with:
      operating-system: macos-13
      install-docker: false
      make-command: install-python-dependencies
      pytest-args: "./tests/unit -k 'not test_sandbox'"

  test-on-ubuntu:
    name: Run Unit Tests on Ubuntu
    uses: ./.github/workflows/setup-environment.yml
    with:
      operating-system: ubuntu-latest
      install-docker: false
      make-command: install-python-dependencies
      pytest-args: "./tests/unit -k 'not test_sandbox'"


  test_matrix_success:
    name: All Mac/Linux Tests Passed
    runs-on: ubuntu-latest
    needs: [test-on-macos, test-on-ubuntu]
    steps:
    - run: echo Done!
