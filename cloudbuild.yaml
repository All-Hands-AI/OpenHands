steps:
# Clone the repository
- name: 'gcr.io/cloud-builders/git'
  id: 'clone'
  args:
    - clone
    - '--recurse-submodules'
    - 'https://github.com/AhmedProab/OpenHands.git'
    - '.'

# List files to verify clone
- name: 'ubuntu'
  id: 'verify'
  args: ['ls', '-la']
  waitFor: ['clone']

# Build Docker image
- name: 'gcr.io/cloud-builders/docker'
  id: 'build'
  args:
    - 'build'
    - '-t'
    - 'us-central1-docker.pkg.dev/dynamic-ai-openhands/openhands/app'
    - '--build-arg'
    - 'OPENHANDS_BUILD_VERSION=${_VERSION}'
    - '-f'
    - 'containers/app/Dockerfile'
    - '.'
  env:
    - 'DOCKER_BUILDKIT=1'
  waitFor: ['verify']

substitutions:
  _VERSION: 'dev'
images:
- 'us-central1-docker.pkg.dev/dynamic-ai-openhands/openhands/app'
timeout: '3600s'
options:
  machineType: 'N1_HIGHCPU_8'
  diskSizeGb: '100'
  logging: CLOUD_LOGGING_ONLY
